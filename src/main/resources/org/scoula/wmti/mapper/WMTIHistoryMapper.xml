<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.scoula.wmti.mapper.WMTIHistoryMapper">

    <!-- 설문 이력 저장 -->
    <insert id="saveWMTIHistory" parameterType="org.scoula.wmti.entity.WMTIHistory">
        INSERT INTO wmti_history (member_id, answers_json, result_type, wmti_code,
                                  a, p, m, t, risk_preference, created_at)
        VALUES (#{memberId}, #{answersJson}, #{resultType}, #{wmtiCode},
                #{a}, #{p}, #{m}, #{t}, #{riskPreference}, #{createdAt});
    </insert>

    <!-- 사용자 ID로 설문 이력 조회 (최근1개)-->
    <select id="findByMemberId" parameterType="long" resultType="org.scoula.wmti.entity.WMTIHistory">
        SELECT history_id AS historyId,
        member_id AS memberId,
        answers_json AS answersJson,
        result_type AS resultType,
        wmti_code AS wmtiCode,
        a AS a,
        p AS p,
        m AS m,
        t AS t,
        risk_preference AS riskPreference,
        created_at AS createdAt
        FROM wmti_history
        WHERE member_id = #{memberId}
        ORDER BY created_at DESC
        LIMIT 1;
    </select>

    <!--사용자 ID로 모든 설문이력조회 (전체 리스트)    -->
    <select id="findAllByMemberId" parameterType="long" resultType="org.scoula.wmti.entity.WMTIHistory">
        SELECT history_id AS historyId,
        member_id AS memberId,
        answers_json AS answersJson,
        result_type AS resultType,
        wmti_code AS wmtiCode,
        a AS a,
        p AS p,
        m AS m,
        t AS t,
        risk_preference AS riskPreference,
        created_at AS createdAt
        FROM wmti_history
        WHERE member_id = #{memberId}
        ORDER BY created_at DESC;
    </select>

    <!-- 사용자 ID와 이력 ID로 설문 이력 조회(특정 이력 조회용) -->
    <select id="findByHistoryId" parameterType="long" resultType="org.scoula.wmti.entity.WMTIHistory">
        SELECT history_id AS historyId,
        member_id AS memberId,
        answers_json AS answersJson,
        result_type AS resultType,
        wmti_code AS wmtiCode,
        a AS a,
        p AS p,
        m AS m,
        t AS t,
        risk_preference AS riskPreference,
        created_at AS createdAt
        FROM wmti_history
        WHERE history_id = #{historyId}
    </select>

    <!-- 설문 이력 삭제 -->
    <delete id="deleteByHistoryId" parameterType="long">
        DELETE FROM wmti_history
        WHERE history_id = #{historyId};
    </delete>
</mapper>
