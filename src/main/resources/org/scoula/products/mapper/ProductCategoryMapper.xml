<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.scoula.products.mapper.ProductCategoryMapper">

    <!-- 모든 카테고리 조회 -->
    <select id="findAllCategories" resultType="java.util.Map">
        SELECT category_id as "id",
               CASE
                   WHEN category_id = 1 THEN 'deposit'
                   WHEN category_id = 2 THEN 'loan'
                   WHEN category_id = 3 THEN 'fund'
                   WHEN category_id = 4 THEN 'insurance'
                   WHEN category_id = 5 THEN 'pension'
                   WHEN category_id = 6 THEN 'realestate'
                   ELSE LOWER(REPLACE(name, ' ', ''))
                   END     as "code",
               name,
               description
        FROM product_category
        ORDER BY category_id
    </select>

    <!-- 카테고리 ID로 하위 카테고리 목록 조회 -->
    <select id="findSubcategoriesByCategoryId" resultType="java.util.Map">
        SELECT
            subcategory_id as "id",
            category_id as "categoryId",
            name,
            description
        FROM
            product_subcategory
        WHERE
            category_id = #{categoryId}
        ORDER BY
            subcategory_id
    </select>

    <!-- 카테고리 코드로 카테고리 정보 조회 -->
    <select id="findCategoryByCode" resultType="java.util.Map">
        SELECT
            category_id as "id",
            CASE
                WHEN category_id = 1 THEN 'deposit'
                WHEN category_id = 2 THEN 'loan'
                WHEN category_id = 3 THEN 'fund'
                WHEN category_id = 4 THEN 'insurance'
                WHEN category_id = 5 THEN 'pension'
                WHEN category_id = 6 THEN 'realestate'
                ELSE LOWER(REPLACE(name, ' ', ''))
            END as "code",
            name,
            description
        FROM
            product_category
        WHERE
            CASE
                WHEN #{code} = 'deposit' THEN category_id = 1
                WHEN #{code} = 'loan' THEN category_id = 2
                WHEN #{code} = 'fund' THEN category_id = 3
                WHEN #{code} = 'insurance' THEN category_id = 4
                WHEN #{code} = 'pension' THEN category_id = 5
                WHEN #{code} = 'realestate' THEN category_id = 6
                ELSE LOWER(REPLACE(name, ' ', '')) = #{code}
            END
    </select>

    <!-- 여러 카테고리 ID로 하위 카테고리 목록 조회 -->
    <select id="findSubcategoriesByMultipleCategoryIds" resultType="java.util.Map">
        SELECT
            subcategory_id as id,
            category_id as categoryId,
            name,
            description
        FROM
            product_subcategory
        WHERE
            category_id IN
            <foreach item="id" collection="categoryIds" open="(" separator="," close=")">
                #{id}
            </foreach>
    </select>
</mapper>