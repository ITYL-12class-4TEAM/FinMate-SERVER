<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.scoula.products.mapper.PensionProductMapper">

    <!-- 상품 ID로 연금 상품 상세 정보 조회 -->
    <select id="findByProductId" resultType="org.scoula.products.dto.response.pension.PensionProductDTO">
        SELECT pp.*, fp.fin_co_no, fp.fin_prdt_cd, fp.product_name as fin_prdt_nm, fp.kor_co_nm
        FROM pension_product pp
        JOIN financial_product fp ON pp.product_id = fp.product_id
        WHERE fp.fin_prdt_cd = #{productId}
    </select>

    <!-- 상품 ID로 연금 상품 옵션 정보 조회 -->
    <select id="findOptionsByProductId" resultType="org.scoula.products.dto.response.pension.PensionOptionDTO">
        SELECT po.*
        FROM pension_option po
        JOIN financial_product fp ON po.product_id = fp.product_id
        WHERE fp.fin_prdt_cd = #{productId}
    </select>

    <!-- 연금 상품 목록 조회 (필터링 적용) -->
    <select id="findPensionProducts" resultType="org.scoula.products.dto.response.pension.PensionProductDTO">
        SELECT pp.*, fp.fin_co_no, fp.fin_prdt_cd, fp.product_name as fin_prdt_nm, fp.kor_co_nm
        FROM pension_product pp
        JOIN financial_product fp ON pp.product_id = fp.product_id
        <where>
            <if test="pnsnKind != null and pnsnKind != ''">
                AND pp.pnsn_kind = #{pnsnKind}
            </if>
            <if test="prdtType != null and prdtType != ''">
                AND pp.prdt_type = #{prdtType}
            </if>
            <if test="guarRate != null">
                AND pp.guar_rate >= #{guarRate}
            </if>
        </where>
    </select>
</mapper>