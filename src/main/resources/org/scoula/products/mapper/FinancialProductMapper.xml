<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.scoula.products.mapper.FinancialProductMapper">

    <!-- 상품 목록 조회 -->
    <select id="findProducts" resultType="map">
        SELECT fp.*, c.name as category_name, do.intr_rate, do.intr_rate2, do.save_trm
        FROM financial_product fp
        JOIN product_category c ON fp.category_id = c.category_id
        JOIN deposit_product dp ON fp.product_id = dp.product_id
        JOIN deposit_option do ON dp.product_id = do.product_id
        WHERE c.name = #{productType}
        <if test="keyword != null and keyword != ''">
            AND (fp.product_name LIKE CONCAT('%', #{keyword}, '%')
                OR fp.kor_co_nm LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        <if test="minIntrRate != null">
            AND do.intr_rate >= #{minIntrRate}
        </if>
        <if test="saveTrm != null">
            AND do.save_trm = #{saveTrm}
        </if>
        <if test="intrRateType != null and intrRateType != ''">
            AND do.intr_rate_type = #{intrRateType}
        </if>
        <if test="joinWay != null and joinWay != ''">
            AND dp.join_way LIKE CONCAT('%', #{joinWay}, '%')
        </if>
    </select>

    <!-- 상품명 자동완성 검색 -->
    <select id="findProductNamesByKeyword" resultType="string">
        SELECT DISTINCT product_name
        FROM financial_product
        WHERE product_name LIKE CONCAT('%', #{keyword}, '%')
        LIMIT 10
    </select>
</mapper>